name: Build & Deploy
on:
  push:
    branches: [ master ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js environment
      uses: actions/setup-node@v3.6.0
      with:
        node-version: '16.x'

    - name: Install dependencies
      run: npm i

    - name: Build app
      run: npm run build

    - name: Create archive
      run: tar -czf app.tar.gz dist

    

    - name: SSH Server Deploy
      uses: kostyaten/ssh-server-deploy@v4
      with:
        host: ssh.alpha-ome.ga
        port: 500
        username: admin
        password: ${{ secrets.SSH_PASSWORD }}
        after_script: |
          tar -xf app.tar.gz
        scp_source: app.tar.gz
        scp_target: app.tar.gz
